# JRun平台 MVP 版本技术实现计划（PLAN.md）

## 1. 项目概述

### 1.1 项目目标
构建一款支持 Android/iOS 移动端、Web 端自动化测试与接口自动化测试的一体化平台，实现"项目管理→用例编写→设备选择→测试执行→报告查看→告警通知"的全流程闭环，提升测试效率与结果可视化程度。

### 1.2 核心受众
测试工程师、项目负责人、平台管理员

### 1.3 MVP 版本范围
| 类别 | 包含内容 | 暂不包含 |
|------|----------|----------|
| 架构 | 前后端分离架构、Docker 部署、多环境隔离 | 微服务架构、插件化扩展、CI/CD 集成 |
| 核心功能 | 用户/项目/设备管理、自动化用例编写与调试、测试执行、测试报告、数据分析大屏、告警通知 | 用例版本管理、批量操作、报告对比、插件开发、日志管理、数据加密 |
| 自动化能力 | Android/iOS/Web UI 自动化、接口自动化、SDK 健康检查 | 无线设备连接、失败重试、定时执行计划 |

## 2. 技术架构

### 2.1 整体架构
- **架构模式**：前后端分离
- **部署方案**：Docker 容器化部署，支持开发/测试/生产多环境隔离
- **认证方式**：JWT + OAuth2.0 双重认证

### 2.2 技术栈选型
| 层面 | 技术选型                   | 补充说明                                |
|------|------------------------|-------------------------------------|
| 前端 | Vue + 使用ShadcnUI    | 使用Shadcn 设计规范参考design_system.md ，保证界面一致性 |
| 后端 | Spring Boot            | 核心业务逻辑开发、接口提供                       |
| 移动端 SDK | 自研 Android/iOS 自动化 SDK | 支持 Android 10+、iOS 14+，内置健康检查机制     |
| 数据库 | MySQL                  | 存储用户、项目、用例、报告等核心数据                  |

## 3. 核心功能模块实现计划

### 3.1 用户管理模块

#### 3.1.1 基础功能实现
- **用户注册/创建/编辑/禁用/删除**：
  - 后端：实现User实体、UserRepository、UserService、UserController
    - 已实现：User实体、UserRepository、AuthController、AuthService、DTOs
  - 前端：实现用户管理页面，包含CRUD操作界面
    - 已实现：登录页面 (login.html)
- **个人信息维护**：
  - 后端：实现个人信息更新接口
  - 前端：实现个人信息编辑页面
- **密码重置/找回**：
  - 后端：实现密码重置逻辑，包括邮件验证
  - 前端：实现密码重置页面

#### 3.1.2 登录登出实现
- **JWT认证实现**：
  - 后端：实现JWT工具类、认证过滤器、登录接口
  - 前端：实现登录页面、Token存储管理
- **OAuth2.0集成**：
  - 后端：配置OAuth2.0安全配置
  - 前端：实现第三方登录按钮

#### 3.1.3 权限与角色体系实现
- **角色管理**：
  - 后端：实现Role实体、权限配置
  - 前端：实现角色管理界面
- **细粒度权限控制**：
  - 后端：实现基于RBAC模型的权限控制
  - 前端：实现权限控制指令

### 3.2 项目管理模块

#### 3.2.1 项目生命周期实现
- **项目创建**：
  - 后端：实现Project实体、项目创建逻辑
  - 前端：实现项目创建表单
- **项目配置**：
  - 后端：实现项目配置相关接口
  - 前端：实现项目配置页面
- **项目归档**：
  - 后端：实现项目归档状态管理
  - 前端：实现项目归档功能

#### 3.2.2 关联管理实现
- **用例管理**：
  - 后端：实现项目与用例的关联逻辑
  - 前端：实现项目内用例管理界面
- **报告管理**：
  - 后端：实现按项目维度归档报告
  - 前端：实现报告筛选功能

### 3.3 设备管理模块

#### 3.3.1 设备支持范围实现
- **Android设备支持**（Android 10+）：
  - 后端：实现Android设备连接管理
  - SDK：实现Android自动化SDK
- **iOS设备支持**（iOS 14+）：
  - 后端：实现iOS设备连接管理
  - SDK：实现iOS自动化SDK
- **Web浏览器支持**：
  - 后端：实现Web驱动管理
  - SDK：集成Selenium WebDriver

#### 3.3.2 核心功能实现
- **设备注册**：
  - 后端：实现设备自动识别和注册逻辑
  - 前端：实现设备列表页面
- **状态监控**：
  - 后端：实现设备状态监控服务
  - 前端：实现实时状态显示
- **设备管理**：
  - 后端：实现设备分组、标签、备注功能
  - 前端：实现设备管理界面
- **执行分配**：
  - 后端：实现设备分配算法
  - 前端：实现设备选择界面

### 3.4 自动化用例模块

#### 3.4.1 用例类型实现
- **Android UI自动化**：
  - SDK：实现Android UI自动化功能
  - 前端：实现Android UI用例编辑器
- **iOS UI自动化**：
  - SDK：实现iOS UI自动化功能
  - 前端：实现iOS UI用例编辑器
- **Web UI自动化**：
  - SDK：实现Web UI自动化功能
  - 前端：实现Web UI用例编辑器
- **接口自动化**：
  - 后端：实现接口自动化执行引擎
  - 前端：实现接口用例编辑器

#### 3.4.2 在线编辑器实现
- **代码编辑器**：
  - 前端：集成Monaco Editor，支持语法高亮、自动补全
  - 后端：实现代码片段管理
- **语言支持**：
  - 前端：支持Java语法高亮和提示
  - 后端：实现脚本解析和验证

#### 3.4.3 编写与调试实现
- **UI自动化编写**：
  - 前端：实现元素定位器选择器、可视化录制工具
  - 后端：实现定位器验证接口
- **接口自动化编写**：
  - 前端：实现请求配置界面
  - 后端：实现接口请求执行逻辑
- **调试功能**：
  - 前端：实现实时日志输出、步骤可视化
  - 后端：实现调试执行模式

#### 3.4.4 环境变量管理实现
- **分层配置**：
  - 后端：实现全局和项目级环境变量管理
  - 前端：实现环境变量配置界面
- **变量应用**：
  - 后端：实现变量替换逻辑
  - 前端：实现变量引用提示

### 3.5 测试执行模块

#### 3.5.1 执行配置实现
- **环境参数自定义**：
  - 前端：实现执行配置表单
  - 后端：实现执行参数验证和应用
- **执行策略**：
  - 后端：实现并发控制、失败处理策略
  - 前端：实现执行策略配置

#### 3.5.2 执行监控实现
- **实时监控**：
  - 后端：实现执行状态推送服务
  - 前端：实现执行进度监控界面
  - 通信：使用WebSocket实现实时数据推送

### 3.6 测试报告模块

#### 3.6.1 报告核心内容实现
- **基础信息记录**：
  - 后端：实现报告数据模型和存储
  - 前端：实现报告详情页面
- **执行详情记录**：
  - 后端：实现执行步骤详细记录
  - 前端：实现步骤详情展示
- **失败信息记录**：
  - 后端：实现截图和日志存储
  - 前端：实现失败信息展示

#### 3.6.2 报告操作实现
- **在线查看**：
  - 前端：实现报告查看页面
  - 后端：实现报告查询接口
- **筛选功能**：
  - 前端：实现报告筛选界面

### 3.7 数据分析大屏模块

#### 3.7.1 核心指标实现
- **用例执行通过率统计**：
  - 后端：实现统计查询逻辑
  - 前端：实现图表展示
- **自动化覆盖率统计**：
  - 后端：实现覆盖率计算逻辑
  - 前端：实现覆盖率图表
- **接口响应时间分布**：
  - 后端：实现响应时间统计
  - 前端：实现时间分布图表
- **设备稳定性统计**：
  - 后端：实现设备稳定性计算
  - 前端：实现设备稳定性图表
- **用例失败TOP原因**：
  - 后端：实现失败原因统计
  - 前端：实现失败原因图表

#### 3.7.2 可视化与筛选实现
- **可视化形式**：
  - 前端：集成ECharts图表库
- **筛选功能**：
  - 前端：实现多维度筛选界面

### 3.8 告警通知模块

#### 3.8.1 告警触发条件实现
- **测试任务执行失败告警**：
  - 后端：实现告警触发逻辑
- **SDK健康检查异常告警**：
  - 后端：实现健康检查和告警逻辑

#### 3.8.2 告警配置实现
- **告警级别**：
  - 后端：实现告警级别配置
- **通知渠道**：
  - 后端：实现邮件和企业微信通知
  - 前端：实现告警配置界面

## 4. 自然语言自动化脚本扩展实现

### 4.1 自然语言解析器架构
- **语法解析层**：实现词法分析和语法分析
- **语义理解层**：实现意图识别和实体提取
- **操作映射层**：实现自然语言到UI操作映射
- **执行适配层**：调用原生SDK接口

### 4.2 脚本解析器实现
- **自然语言解析器**：支持中文自然语言描述
- **JavaScript解析器**：支持JavaScript格式脚本
- **YAML解析器**：支持YAML格式脚本
- **解析器工厂**：统一管理各类解析器

### 4.3 UI操作规划算法
- **UI状态感知**：实时获取当前UI状态
- **元素匹配算法**：智能匹配UI元素
- **路径规划算法**：使用A*算法规划操作路径
- **错误恢复机制**：实现多种错误恢复策略

### 4.4 映射机制实现
- **自然语言到UI操作映射**：完整的映射流程
- **可执行步骤封装**：统一的执行步骤模型
- **执行引擎**：完整的自然语言执行流程

## 5. 非功能需求实现

### 5.1 兼容性
- **浏览器兼容**：支持Chrome、Firefox、Edge最新版
- **设备兼容**：支持Android 10+、iOS 14+主流机型
- **系统兼容**：支持Windows Server 2016+、Linux（CentOS 7+/Ubuntu 18+）

### 5.2 性能要求
- **接口响应时间**：核心接口响应时间≤3s
- **并发支持**：支持≤10个测试任务并发执行
- **设备连接**：单服务器支持≤20台测试设备

### 5.3 可用性
- **系统可用性**：≥99.5%
- **故障恢复**：支持手动重试连接

### 5.4 易用性
- **操作流程**：核心流程步骤≤5步
- **编辑器体验**：提供常用代码片段
- **提示反馈**：所有操作均有明确提示

## 6. 实施计划

### 6.1 开发阶段
1. **基础架构搭建**（第1-2周）
   - 搭建前后端基础架构
   - 配置Docker部署环境
   - 实现基础认证授权

2. **核心功能开发**（第3-8周）
   - 用户管理模块
   - 项目管理模块
   - 设备管理模块

3. **自动化用例模块**（第9-12周）
   - 用例编辑器
   - 脚本解析器
   - 执行引擎

4. **执行与报告模块**（第13-15周）
   - 测试执行模块
   - 报告生成模块

5. **高级功能**（第16-18周）
   - 数据分析大屏
   - 告警通知模块
   - 自然语言扩展

### 6.2 测试阶段
- **单元测试**：各模块单元测试
- **集成测试**：模块间集成测试
- **系统测试**：完整系统功能测试
- **性能测试**：性能指标验证

### 6.3 部署阶段
- **开发环境部署**：开发环境搭建
- **测试环境部署**：测试环境搭建
- **生产环境部署**：生产环境部署

## 7. 技术风险与应对

### 7.1 技术风险
- **设备兼容性**：不同设备型号的兼容性问题
- **性能瓶颈**：高并发执行时的性能问题
- **稳定性**：长时间运行的稳定性问题

### 7.2 应对措施
- **设备兼容性**：建立设备测试矩阵，持续测试
- **性能优化**：使用连接池、缓存等优化手段
- **稳定性保障**：实现健康检查、自动恢复机制